/* TheQah Widget - https://theqah.com */
(()=>{"use strict";if(window.__THEQAH_STARS_LOADING__)return;window.__THEQAH_STARS_LOADING__=!0;const t=document.currentScript,e=`${(()=>{try{return new URL(t?.src||location.href).origin}catch{return location.origin}})()}/api/public/reviews`,n=window.__THEQAH__=window.__THEQAH__||{};const o=()=>{try{(async function(){!function(){if(document.getElementById("theqah-stars-css"))return;const t=document.createElement("style");t.id="theqah-stars-css",t.textContent="\n      .theqah-stars-widget{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;display:flex;align-items:center;gap:6px;margin:8px 0}\n      .theqah-stars{display:flex;gap:2px}\n      .theqah-star{font-size:16px;line-height:1}\n      .theqah-star.filled{color:#fbbf24}\n      .theqah-star.half{background:linear-gradient(90deg,#fbbf24 50%,#d1d5db 50%);-webkit-background-clip:text;-webkit-text-fill-color:transparent}\n      .theqah-star.empty{color:#d1d5db}\n      .theqah-count{color:#6b7280;font-size:13px}\n      .theqah-badge{display:flex;align-items:center;gap:3px;background:#ecfdf5;color:#059669;padding:2px 6px;border-radius:999px;font-size:11px;font-weight:600}\n      .theqah-loading{font-size:12px;color:#9ca3af}\n    ",document.head.appendChild(t)}();const o=document.querySelector("script[data-theqah-stars]")||t,a=o?.dataset?.lang||"ar";let r=o?.dataset?.store||"";if((!r||r.includes("{")||/STORE_ID/i.test(r))&&(r=await async function(){const t=location.host.replace(/^www\./,"").toLowerCase();if(n.storeUid)return n.storeUid;const o=`theqah:storeUid:${t}`;try{const t=JSON.parse(localStorage.getItem(o)||"null");if(t&&t.uid&&Date.now()-t.t<6e5)return n.storeUid=t.uid,t.uid}catch{}if(n._starsResolvePromise)return n._starsResolvePromise;const a=new AbortController,r=setTimeout(()=>a.abort(),3e3),s=`${e}/resolve?host=${encodeURIComponent(t)}&href=${encodeURIComponent(location.href)}&v=${encodeURIComponent("1.0.5")}`;return n._starsResolvePromise=fetch(s,{cache:"no-store",signal:a.signal}).then(t=>(clearTimeout(r),t.ok?t.json():null)).then(t=>{const e=t?.storeUid||null;if(e){n.storeUid=e;try{localStorage.setItem(o,JSON.stringify({uid:e,t:Date.now()}))}catch{}}return e}).catch(t=>(clearTimeout(r),console.warn("Stars resolve failed:",t.message),null)).finally(()=>{n._starsResolvePromise=null}),n._starsResolvePromise}()),!r)return void console.warn("theqah-stars: storeUid not found");const s=o?.dataset?.product||"auto",i="auto"===s?function(){try{const t=window?.salla?.config?.get?.("product")||window?.salla?.product||window?.__SALLA_PRODUCT__;if(t&&t.id)return String(t.id)}catch{}const t=location.pathname,e=[/\/p(\d{7,})/,/product[_-](\d{7,})/i,/\/products\/(\d{7,})/,/\/(\d{7,})$/];for(const n of e){const e=t.match(n);if(e)return e[1]}const n=new URLSearchParams(location.search),o=n.get("product")||n.get("id")||n.get("pid");if(o&&/^\d{5,}$/.test(o))return o;try{const t=document.querySelectorAll('script[type="application/ld+json"]');for(const e of t){const t=JSON.parse(e.textContent);if("Product"===t["@type"]){const e=t.productID||t.sku||t.identifier;if(e)return String(e)}}}catch{}return null}():s,c=function(){const t=[".product-details__title",".product-title",".product-name",'h1[itemprop="name"]',"main h1","body h1"];for(const e of t){const t=document.querySelector(e);if(t)return t}return document.body}(),l=document.createElement("div");l.innerHTML='<div class="theqah-loading">...</div>',c.parentNode.insertBefore(l,c.nextSibling);const d=await async function(t,o){const a=`${t}:${o||"all"}`,r=Date.now(),s=n._starsCache=n._starsCache||{};if(s[a]&&r-s[a].t<3e5)return s[a].data;const i=new AbortController,c=setTimeout(()=>i.abort(),6e3);try{let n=`${e}?storeUid=${encodeURIComponent(t)}&limit=1000`;o&&(n+=`&productId=${encodeURIComponent(o)}`);const l=await fetch(n,{cache:"no-store",headers:{Accept:"application/json"},signal:i.signal});if(clearTimeout(c),!l.ok)return null;const d=(await l.json()).items||[];if(!d.length)return null;const u=d.length,h=d.reduce((t,e)=>t+(e.stars||0),0)/u,f={count:u,average:Math.round(2*h)/2,fullStars:Math.floor(h),hasHalfStar:h%1>=.5};return s[a]={t:r,data:f},f}catch(t){return clearTimeout(c),console.warn("Stars stats fetch failed:",t.message),null}}(r,i);d?(l.innerHTML=function(t,e,n){const{count:o,fullStars:a,hasHalfStar:r}=t,s="ar"===(n||"ar");let i="";for(let t=1;t<=5;t++)i+=t<=a?'<span class="theqah-star filled">★</span>':t===a+1&&r?'<span class="theqah-star half">★</span>':'<span class="theqah-star empty">☆</span>';return`\n      <div class="theqah-stars-widget" dir="${s?"rtl":"ltr"}">\n        <div class="theqah-stars">${i}</div>\n        <span class="theqah-count">(${s?1===o?"تقييم واحد":`${o} تقييمات`:1===o?"1 review":`${o} reviews`})</span>\n        <div class="theqah-badge">\n          <span>✓</span>\n          <span>${s?"مشتري موثّق":"Verified Buyer"}</span>\n        </div>\n      </div>\n    `}(d,0,a),console.log("[theqah-stars] mounted on",c)):l.remove()})().catch(t=>console.warn("Stars mount failed:",t.message))}catch(t){console.warn("Stars init failed:",t.message)}finally{window.__THEQAH_STARS_LOADING__=!1}};if("loading"===document.readyState?document.addEventListener("DOMContentLoaded",o):setTimeout(o,50),"undefined"!=typeof MutationObserver){const t=new MutationObserver(t=>{t.some(t=>Array.from(t.addedNodes).some(t=>1===t.nodeType&&t.matches?.("[data-theqah-stars]")))&&!document.querySelector(".theqah-stars-widget")&&o()});try{t.observe(document.body,{childList:!0,subtree:!0,attributes:!1,characterData:!1}),setTimeout(()=>t.disconnect(),2e4)}catch(t){console.warn("Stars observer failed:",t)}}})();